<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>09 找細菌</title>
    <style>
        :root { 
            --bg-color: #ffffff; 
            --modal-mask: rgba(0, 0, 0, 0.7); 
        }
        
        body { 
            margin: 0; 
            padding: 0; 
            display: flex; 
            justify-content: center; 
            align-items: center; 
            width: 100vw;
            height: 100vh;
            background-color: var(--bg-color); 
            font-family: "Microsoft JhengHei", Arial, sans-serif; 
            overflow: hidden; 
            touch-action: none; 
        }

        /* --- 遊戲主容器 --- */
        #game-container { 
            position: relative; 
            width: 960px; 
            height: 720px; 
            transform-origin: center center; 
            box-shadow: 0 0 20px rgba(0,0,0,0.2);
            background-color: #fff;
        }

        /* --- 遊戲內容層 --- */
        .game-scene { position: absolute; top: 13%; left: 23.5%; width: 53%; height: 72%; overflow: hidden; z-index: 1; }
        #grid-bg { position: absolute; top: 0; left: 0; width: 100%; height: 100%; object-fit: fill; opacity: 0.6; z-index: 1; }
        #bacteria-container { position: absolute; top: 0; left: 0; width: 100%; height: 100%; z-index: 2; pointer-events: none; }
        #toys-img { position: absolute; top: 10%; right: 5%; width: 85%; height: auto; z-index: 3; pointer-events: none; }
        
        /* --- 細菌與動畫 --- */
        .bacteria-wrapper { position: absolute; width: 35px; height: 35px; cursor: pointer; pointer-events: auto; transform: translate(var(--hide-x), var(--hide-y)); animation: runAround 7s ease-in-out infinite; z-index: 20; display: flex; justify-content: center; align-items: center; }
        .bacteria-img { width: 100%; height: 100%; display: block; }
        @keyframes runAround { 0% { transform: translate(var(--hide-x), var(--hide-y)); } 20% { transform: translate(0, 0); } 60% { transform: translate(0, 0); } 80% { transform: translate(var(--hide-x), var(--hide-y)); } 100% { transform: translate(var(--hide-x), var(--hide-y)); } }
        
        /* --- -1 動畫 --- */
        .minus-one { position: fixed; width: 50px; height: auto; z-index: 9999; pointer-events: none; animation: floatUpFade 0.8s ease-out forwards; }
        @keyframes floatUpFade { 0% { opacity: 1; transform: translateY(0) scale(1); } 100% { opacity: 0; transform: translateY(-60px) scale(1.5); } }
        
        #frame-bg { position: absolute; top: 0; left: 0; width: 100%; height: 100%; z-index: 10; pointer-events: none; }
        
        /* UI 按鈕 */
        .ui-btn { position: absolute; cursor: pointer; z-index: 20; transition: transform 0.1s; }
        .ui-btn:active { transform: scale(0.95); }
        #title-img { position: absolute; top: 2%; left: 50%; transform: translateX(-50%); width: 30%; z-index: 20; pointer-events: none; }
        
        /* 遊戲畫面上的按鈕 */
        #close-btn { top: 4%; right: 4%; width: 80px; }
        #hint-btn { bottom: 12%; right: 6%; width: 130px; }

        /* --- 視窗統一標準設定 (修改處) --- */
        .modal { 
            display: none; 
            position: absolute; /* 改為 absolute，相對於 game-container */
            top: 0; left: 0; 
            width: 100%; height: 100%; 
            background-color: var(--modal-mask); 
            z-index: 100; 
            justify-content: center; 
            align-items: center; 
        }
        
        /* [修改] 統一視窗寬度為 780px */
        .modal-content-standard, #pause-modal-content { 
            position: relative; 
            width: 780px; /* 這裡設定寬度 */
            display: flex; 
            justify-content: center; 
            align-items: center; 
            flex-direction: column; 
        }
        
        .modal-img-full { width: 100%; height: auto; display: block; }
        
        /* [修改] 統一右上角按鈕 (叉叉或過關按鈕) */
        .modal-close-standard { 
            position: absolute; 
            top: -30px;      /* 往上移出視窗 */
            right: -60px;    /* 往右移出視窗 */
            width: 90px;     /* 稍微加大 */
            cursor: pointer; 
            z-index: 101; 
            transition: transform 0.1s; 
            transform: none; /* 移除之前的 transform */
        }
        .modal-close-standard:hover { transform: scale(1.1); }

        /* 暫停視窗按鈕容器 */
        .pause-btns-container { position: absolute; bottom: 15%; left: 0; width: 100%; display: flex; justify-content: center; gap: 30px; }
        .pause-btn-img { width: 160px; cursor: pointer; transition: transform 0.1s; }
        .pause-btn-img:active { transform: scale(0.95); }

    </style>
</head>
<body>

    <div id="game-container">
        <img src="img/09-0.png" id="title-img" alt="標題">
        <div class="game-scene">
            <img src="img/0.png" id="grid-bg" alt="格子背景">
            <div id="bacteria-container"></div>
            <img src="img/09-3.png" id="toys-img" alt="玩具">
        </div>
        <img src="img/00.png" id="frame-bg" alt="背景框">
        <img src="img/004.png" id="close-btn" class="ui-btn" onclick="showPauseModal()" alt="關閉">
        <img src="img/0-1.png" id="hint-btn" class="ui-btn" onclick="showHint()" alt="提示">

        <div id="hint-modal" class="modal">
            <div class="modal-content-standard">
                <img src="img/09-1.png" alt="提示內容" class="modal-img-full">
                <img src="img/0-2.png" class="modal-close-standard" onclick="hideHint()" alt="關閉">
            </div>
        </div>

        <div id="pause-modal" class="modal">
            <div id="pause-modal-content">
                <img src="img/001.png" alt="暫停框" class="modal-img-full">
                <div class="pause-btns-container">
                    <img src="img/002.png" class="pause-btn-img" onclick="quitGame()" alt="放棄">
                    <img src="img/003.png" class="pause-btn-img" onclick="hidePauseModal()" alt="繼續玩">
                </div>
            </div>
        </div>

        <div id="win-modal" class="modal">
            <div class="modal-content-standard">
                <img src="img/09-100.png" alt="過關" class="modal-img-full">
                <img src="img/101.png" class="modal-close-standard" onclick="closeWinModal()" alt="完成">
            </div>
        </div>
    </div>

    <script>
        // --- 1. 平板縮放腳本 ---
        function resizeGame() {
            const container = document.getElementById('game-container');
            const targetWidth = 960;
            const targetHeight = 720;
            const windowWidth = window.innerWidth;
            const windowHeight = window.innerHeight;
            const scale = Math.min(windowWidth / targetWidth, windowHeight / targetHeight);
            
            container.style.transform = `scale(${scale})`;
        }
        window.addEventListener('resize', resizeGame);
        
        // --- 2. 遊戲邏輯 ---
        const bacteriaContainer = document.getElementById('bacteria-container');
        const totalBacteriaNeeded = 5; 
        let clearedCount = 0;

        const hidingSpots = [
            { x: 30, y: 18, hideX: '0px', hideY: '50px' }, { x: 50, y: 28, hideX: '50px', hideY: '0px' },
            { x: 28, y: 33, hideX: '0px', hideY: '-40px' }, { x: 54, y: 38, hideX: '-10px', hideY: '11px' },
            { x: 75, y: 36, hideX: '0px', hideY: '50px' }, { x: 38, y: 65, hideX: '-20px', hideY: '5px' },
            { x: 20, y: 55, hideX: '0px', hideY: '30px' }, { x: 55, y: 47, hideX: '0px', hideY: '20px' }, 
            { x: 35, y: 81, hideX: '-60px', hideY: '0px' }, { x: 65, y: 72, hideX: '0px', hideY: '25px' },
            { x: 82, y: 72, hideX: '0px', hideY: '22px' }
        ];

        function initGame() { 
            resizeGame(); // 初始化時執行縮放
            spawnRandomBugs(); 
        }
        
        function spawnRandomBugs() {
            const shuffled = hidingSpots.sort(() => 0.5 - Math.random());
            const selectedSpots = shuffled.slice(0, totalBacteriaNeeded);
            selectedSpots.forEach((spot) => { createBacteria(spot); });
        }

        function createBacteria(spot) {
            const wrapper = document.createElement('div');
            wrapper.classList.add('bacteria-wrapper');
            wrapper.style.left = spot.x + '%'; wrapper.style.top = spot.y + '%';
            wrapper.style.setProperty('--hide-x', spot.hideX); wrapper.style.setProperty('--hide-y', spot.hideY);
            wrapper.style.animationDelay = `-${Math.random() * 5}s`;
            const img = document.createElement('img'); img.src = "img/09-4.png"; img.classList.add('bacteria-img');
            wrapper.appendChild(img);
            
            const cleanAction = function(e) {
                e.preventDefault(); 
                cleanBacteria(wrapper);
            };
            wrapper.addEventListener('mousedown', cleanAction);
            wrapper.addEventListener('touchstart', cleanAction);
            
            bacteriaContainer.appendChild(wrapper);
        }

        function cleanBacteria(element) {
            showMinusOne(element);
            element.style.animation = 'none'; element.style.pointerEvents = "none"; element.style.transition = "transform 0.5s ease-in";
            const hideX = element.style.getPropertyValue('--hide-x'); const hideY = element.style.getPropertyValue('--hide-y');
            element.style.transform = `translate(${hideX}, ${hideY})`;
            setTimeout(() => {
                element.remove(); clearedCount++;
                if (clearedCount === totalBacteriaNeeded) {
                    setTimeout(() => { document.getElementById('win-modal').style.display = 'flex'; }, 500);
                }
            }, 500); 
        }

        function showMinusOne(targetElement) {
            const rect = targetElement.getBoundingClientRect();
            const minus = document.createElement('img'); minus.src = "img/09-5.png"; minus.classList.add('minus-one');
            // 注意：因為現在 body 有 scale，直接抓 rect 可能會有位移，但對於簡單效果通常影響不大
            // 若位置跑掉，可以考慮將 -1 動畫也放入 game-container 內
            minus.style.left = rect.left + 'px'; minus.style.top = rect.top + 'px';
            document.body.appendChild(minus);
            setTimeout(() => { minus.remove(); }, 800);
        }

        function showHint() { document.getElementById('hint-modal').style.display = 'flex'; }
        function hideHint() { document.getElementById('hint-modal').style.display = 'none'; }
        function showPauseModal() { document.getElementById('pause-modal').style.display = 'flex'; }
        function hidePauseModal() { document.getElementById('pause-modal').style.display = 'none'; }
        function closeWinModal() { window.location.href = 'index.html'; }
        function quitGame() { window.location.href = 'index.html'; }

        window.onload = initGame;
    </script>
</body>
</html>